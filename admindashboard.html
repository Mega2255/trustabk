<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Trusta</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        :root {
            --navy: #001f3f;
            --navy-light: #003d7a;
            --accent: #667eea;
        }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .gradient-navy { background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%); }
        .gradient-accent { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .gradient-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .gradient-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .gradient-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .hover-up { transition: all 0.3s; }
        .hover-up:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.15); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.6s ease-out; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 1rem; overflow-y: auto; }
        .modal.active { display: flex; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-blocked { background: #fee2e2; color: #991b1b; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-declined { background: #fee2e2; color: #991b1b; }
        .sidebar { position: fixed; left: 0; top: 0; height: 100vh; width: 260px; background: white; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 100; transition: transform 0.3s; }
        .sidebar.hidden { transform: translateX(-100%); }
        .main-content { margin-left: 260px; transition: margin-left 0.3s; }
        .main-content.full { margin-left: 0; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .mobile-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; z-index: 100; }
        }
        .stat-card { background: white; border-radius: 1.5rem; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.07); }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; }
        th { background: #f9fafb; font-weight: 600; text-align: left; padding: 1rem; border-bottom: 2px solid #e5e7eb; }
        td { padding: 1rem; border-bottom: 1px solid #f3f4f6; }
        tr:hover { background: #f9fafb; }
        .search-box { position: relative; }
        .search-box input { padding-left: 2.5rem; }
        .search-box i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #9ca3af; }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-shield-halved text-xl text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800">Trusta Admin</h1>
                    <p class="text-xs text-gray-500">Control Panel</p>
                </div>
            </div>
        </div>
        
        <nav class="p-4">
            <a href="#" onclick="showSection('dashboard')" class="nav-item flex items-center space-x-3 p-3 rounded-xl mb-2 bg-indigo-50 text-indigo-600">
                <i class="fas fa-chart-line w-5"></i>
                <span class="font-semibold">Dashboard</span>
            </a>
            <a href="#" onclick="showSection('users')" class="nav-item flex items-center space-x-3 p-3 rounded-xl mb-2 text-gray-600 hover:bg-gray-50">
                <i class="fas fa-users w-5"></i>
                <span class="font-semibold">Users</span>
            </a>
            <a href="#" onclick="showSection('transactions')" class="nav-item flex items-center space-x-3 p-3 rounded-xl mb-2 text-gray-600 hover:bg-gray-50">
                <i class="fas fa-exchange-alt w-5"></i>
                <span class="font-semibold">Transactions</span>
            </a>
            <a href="#" onclick="showSection('funding')" class="nav-item flex items-center space-x-3 p-3 rounded-xl mb-2 text-gray-600 hover:bg-gray-50">
                <i class="fas fa-wallet w-5"></i>
                <span class="font-semibold">Fund Users</span>
            </a>
            <a href="#" onclick="showSection('settings')" class="nav-item flex items-center space-x-3 p-3 rounded-xl mb-2 text-gray-600 hover:bg-gray-50">
                <i class="fas fa-cog w-5"></i>
                <span class="font-semibold">Settings</span>
            </a>
        </nav>

        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200">
            <button onclick="adminLogout()" class="w-full flex items-center justify-center space-x-2 p-3 rounded-xl bg-red-50 text-red-600 hover:bg-red-100 transition">
                <i class="fas fa-sign-out-alt"></i>
                <span class="font-semibold">Logout</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <div id="main-content" class="main-content min-h-screen pb-20 md:pb-6">
        <!-- Top Bar -->
        <div class="bg-white shadow-sm sticky top-0 z-50">
            <div class="flex items-center justify-between p-4">
                <button onclick="toggleSidebar()" class="md:hidden text-gray-600">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <div class="flex-1 max-w-xl mx-4">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search users, transactions..." class="w-full pl-10 pr-4 py-2 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button class="relative p-2 text-gray-600 hover:bg-gray-100 rounded-lg">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                    </button>
                    <div class="user-avatar">A</div>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="section-dashboard" class="section-content p-4 md:p-6">
            <div class="mb-6">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Dashboard Overview</h2>
                <p class="text-gray-600 text-sm">Monitor your platform's performance</p>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="stat-card hover-up slide-up">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 rounded-xl gradient-accent flex items-center justify-center">
                            <i class="fas fa-users text-white text-xl"></i>
                        </div>
                        <span class="text-green-500 text-sm font-semibold">+12%</span>
                    </div>
                    <h3 class="text-2xl md:text-3xl font-bold text-gray-800" id="total-users">0</h3>
                    <p class="text-gray-600 text-sm">Total Users</p>
                </div>

                <div class="stat-card hover-up slide-up" style="animation-delay: 0.1s;">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 rounded-xl gradient-success flex items-center justify-center">
                            <i class="fas fa-user-check text-white text-xl"></i>
                        </div>
                        <span class="text-green-500 text-sm font-semibold">+8%</span>
                    </div>
                    <h3 class="text-2xl md:text-3xl font-bold text-gray-800" id="active-users">0</h3>
                    <p class="text-gray-600 text-sm">Active Users</p>
                </div>

                <div class="stat-card hover-up slide-up" style="animation-delay: 0.2s;">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 rounded-xl gradient-warning flex items-center justify-center">
                            <i class="fas fa-clock text-white text-xl"></i>
                        </div>
                        <span class="text-yellow-600 text-sm font-semibold">Pending</span>
                    </div>
                    <h3 class="text-2xl md:text-3xl font-bold text-gray-800" id="pending-transactions">0</h3>
                    <p class="text-gray-600 text-sm">Pending Txns</p>
                </div>

                <div class="stat-card hover-up slide-up" style="animation-delay: 0.3s;">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-12 h-12 rounded-xl gradient-navy flex items-center justify-center">
                            <i class="fas fa-dollar-sign text-white text-xl"></i>
                        </div>
                        <span class="text-green-500 text-sm font-semibold">+15%</span>
                    </div>
                    <h3 class="text-2xl md:text-3xl font-bold text-gray-800" id="total-volume">$0</h3>
                    <p class="text-gray-600 text-sm">Total Volume</p>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="glass rounded-2xl shadow-lg p-6 mb-6 slide-up" style="animation-delay: 0.4s;">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-clock mr-2 text-indigo-600"></i>Recent Activity
                </h3>
                <div class="space-y-3" id="recent-activity">
                    <div class="flex items-center justify-between p-4 rounded-xl bg-gray-50">
                        <div class="flex items-center space-x-3">
                            <div class="user-avatar text-sm">AD</div>
                            <div>
                                <p class="font-semibold text-gray-800">Loading activity...</p>
                                <p class="text-xs text-gray-500">Please wait</p>
                            </div>
                        </div>
                        <span class="text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold">LOADING</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="section-users" class="section-content p-4 md:p-6 hidden">
            <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800">User Management</h2>
                    <p class="text-gray-600 text-sm">View and manage all users</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="loadUsers()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <div class="glass rounded-2xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>USD Balance</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading users...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Transactions Section -->
        <div id="section-transactions" class="section-content p-4 md:p-6 hidden">
            <div class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Transactions</h2>
                    <p class="text-gray-600 text-sm">Approve or decline pending transactions</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="loadTransactions()" class="px-4 py-2 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>

            <div class="glass rounded-2xl shadow-lg overflow-hidden">
                <div class="overflow-x-auto">
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactions-table-body">
                            <tr>
                                <td colspan="6" class="text-center py-8 text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading transactions...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Funding Section -->
        <div id="section-funding" class="section-content p-4 md:p-6 hidden">
            <div class="mb-6">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Fund Users</h2>
                <p class="text-gray-600 text-sm">Add funds to user accounts</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="glass rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-dollar-sign mr-2 text-green-600"></i>Fund USD
                    </h3>
                    <form id="fund-usd-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select User</label>
                            <select id="fund-user-usd" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                                <option value="">Loading users...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Amount (USD)</label>
                            <input type="number" step="0.01" id="fund-amount-usd" placeholder="0.00" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Note (Optional)</label>
                            <textarea id="fund-note-usd" rows="3" placeholder="Add a note..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none"></textarea>
                        </div>
                        <button type="submit" class="w-full py-3 rounded-xl gradient-success text-white font-semibold hover-up">
                            <i class="fas fa-plus-circle mr-2"></i>Fund Account
                        </button>
                    </form>
                </div>

                <div class="glass rounded-2xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-coins mr-2 text-orange-600"></i>Fund Crypto
                    </h3>
                    <form id="fund-crypto-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Select User</label>
                            <select id="fund-user-crypto" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                                <option value="">Loading users...</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Cryptocurrency</label>
                            <select id="crypto-type" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                                <option value="btc">Bitcoin (BTC)</option>
                                <option value="eth">Ethereum (ETH)</option>
                                <option value="usdt">Tether (USDT)</option>
                                <option value="bnb">Binance Coin (BNB)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Amount</label>
                            <input type="number" step="0.00000001" id="fund-amount-crypto" placeholder="0.00000000" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Note (Optional)</label>
                            <textarea id="fund-note-crypto" rows="3" placeholder="Add a note..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none"></textarea>
                        </div>
                        <button type="submit" class="w-full py-3 rounded-xl gradient-warning text-white font-semibold hover-up">
                            <i class="fas fa-plus-circle mr-2"></i>Fund Crypto
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="section-settings" class="section-content p-4 md:p-6 hidden">
            <div class="mb-6">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Settings</h2>
                <p class="text-gray-600 text-sm">Configure admin preferences</p>
            </div>

            <div class="glass rounded-2xl shadow-lg p-6">
                <div class="space-y-4">
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="font-semibold text-gray-800 mb-1">Admin Email</p>
                        <p class="text-sm text-gray-600" id="admin-email">admin@trusta.com</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="font-semibold text-gray-800 mb-1">Last Login</p>
                        <p class="text-sm text-gray-600" id="last-login">Just now</p>
                    </div>
                    <button onclick="changeAdminPassword()" class="w-full md:w-auto px-6 py-3 rounded-xl gradient-navy text-white font-semibold hover-up">
                        <i class="fas fa-key mr-2"></i>Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Nav -->
    <div class="mobile-nav md:hidden">
        <div class="grid grid-cols-5 gap-1 px-2">
            <button onclick="showSection('dashboard')" class="flex flex-col items-center py-2 text-indigo-600">
                <i class="fas fa-chart-line text-xl mb-1"></i>
                <span class="text-xs font-semibold">Dashboard</span>
            </button>
            <button onclick="showSection('users')" class="flex flex-col items-center py-2 text-gray-400">
                <i class="fas fa-users text-xl mb-1"></i>
                <span class="text-xs">Users</span>
            </button>
            <button onclick="showSection('transactions')" class="flex flex-col items-center py-2 text-gray-400">
                <i class="fas fa-exchange-alt text-xl mb-1"></i>
                <span class="text-xs">Transactions</span>
            </button>
            <button onclick="showSection('funding')" class="flex flex-col items-center py-2 text-gray-400">
                <i class="fas fa-wallet text-xl mb-1"></i>
                <span class="text-xs">Fund</span>
            </button>
            <button onclick="showSection('settings')" class="flex flex-col items-center py-2 text-gray-400">
                <i class="fas fa-cog text-xl mb-1"></i>
                <span class="text-xs">Settings</span>
            </button>
        </div>
    </div>

    <!-- View User Details Modal -->
    <div id="view-user-modal" class="modal">
        <div class="glass rounded-2xl shadow-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-user-circle mr-2 text-indigo-600"></i>User Details
                </h3>
                <button onclick="closeModal('view-user-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="user-details-content">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Fund User Modal -->
    <div id="fund-modal" class="modal">
        <div class="glass rounded-2xl shadow-2xl p-6 max-w-md w-full">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-wallet mr-2 text-green-600"></i>Fund User
                </h3>
                <button onclick="closeModal('fund-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div id="fund-modal-content">
                <!-- Content populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script>
        let allUsers = [];
        let currentSection = 'dashboard';

        // Toggle sidebar for mobile
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Show section
        function showSection(section) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.add('hidden'));
            document.getElementById('section-' + section).classList.remove('hidden');
            
            // Update nav active states
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-indigo-50', 'text-indigo-600');
                item.classList.add('text-gray-600');
            });
            
            const navItems = document.querySelectorAll('.nav-item');
            const sectionMap = { dashboard: 0, users: 1, transactions: 2, funding: 3, settings: 4 };
            if (sectionMap[section] !== undefined) {
                navItems[sectionMap[section]].classList.add('bg-indigo-50', 'text-indigo-600');
                navItems[sectionMap[section]].classList.remove('text-gray-600');
            }

            // Update mobile nav
            document.querySelectorAll('.mobile-nav button').forEach(btn => {
                btn.classList.remove('text-indigo-600');
                btn.classList.add('text-gray-400');
            });
            const mobileMap = { dashboard: 0, users: 1, transactions: 2, funding: 3, settings: 4 };
            if (mobileMap[section] !== undefined) {
                document.querySelectorAll('.mobile-nav button')[mobileMap[section]].classList.add('text-indigo-600');
                document.querySelectorAll('.mobile-nav button')[mobileMap[section]].classList.remove('text-gray-400');
            }
            
            currentSection = section;
            
            // Close sidebar on mobile
            if (window.innerWidth < 768) {
                document.getElementById('sidebar').classList.remove('active');
            }

            // Load data for section
            if (section === 'users') loadUsers();
            if (section === 'transactions') loadTransactions();
            if (section === 'funding') loadUsersForFunding();
        }

        // Load all users
        async function loadUsers() {
            const tbody = document.getElementById('users-table-body');
            tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>Loading users...</p></td></tr>';

            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val();
                allUsers = [];

                if (!users) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No users found</td></tr>';
                    return;
                }

                let html = '';
                let totalUsers = 0;
                let activeUsers = 0;

                for (let uid in users) {
                    const user = users[uid];
                    totalUsers++;
                    const status = user.blocked ? 'blocked' : 'active';
                    if (!user.blocked) activeUsers++;
                    
                    allUsers.push({ uid, ...user });

                    const initials = (user.firstName?.[0] || '') + (user.lastName?.[0] || '');
                    html += `
                        <tr>
                            <td>
                                <div class="flex items-center space-x-3">
                                    <div class="user-avatar text-sm">${initials}</div>
                                    <div>
                                        <p class="font-semibold text-gray-800">${user.firstName || ''} ${user.lastName || ''}</p>
                                        <p class="text-xs text-gray-500">@${user.username || 'N/A'}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="text-sm">${user.email || 'N/A'}</td>
                            <td class="text-sm">${user.phone || 'N/A'}</td>
                            <td class="font-bold text-gray-800">${(user.usdBalance || 0).toFixed(2)}</td>
                            <td>
                                <span class="status-${status} px-3 py-1 rounded-full text-xs font-semibold uppercase">
                                    ${status}
                                </span>
                            </td>
                            <td>
                                <div class="flex gap-2">
                                    <button onclick='viewUser("${uid}")' class="p-2 text-indigo-600 hover:bg-indigo-50 rounded-lg transition" title="View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick='fundUserQuick("${uid}")' class="p-2 text-green-600 hover:bg-green-50 rounded-lg transition" title="Fund">
                                        <i class="fas fa-wallet"></i>
                                    </button>
                                    <button onclick='toggleBlockUser("${uid}", ${user.blocked || false})' class="p-2 text-yellow-600 hover:bg-yellow-50 rounded-lg transition" title="${user.blocked ? 'Unblock' : 'Block'}">
                                        <i class="fas fa-${user.blocked ? 'unlock' : 'ban'}"></i>
                                    </button>
                                    <button onclick='deleteUser("${uid}")' class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }

                tbody.innerHTML = html || '<tr><td colspan="6" class="text-center py-8 text-gray-500">No users found</td></tr>';
                
                // Update stats
                document.getElementById('total-users').textContent = totalUsers;
                document.getElementById('active-users').textContent = activeUsers;

            } catch (error) {
                console.error('Error loading users:', error);
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-red-500">Error loading users</td></tr>';
            }
        }

        // Load all transactions
        async function loadTransactions() {
            const tbody = document.getElementById('transactions-table-body');
            tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>Loading transactions...</p></td></tr>';

            try {
                const snapshot = await database.ref('transactions').once('value');
                const transactions = snapshot.val();

                if (!transactions) {
                    tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500"><i class="fas fa-inbox text-3xl opacity-50 mb-2"></i><p>No transactions found</p></td></tr>';
                    updateTransactionStats(0);
                    return;
                }

                // Convert to array and sort by date
                const txArray = Object.values(transactions).sort((a, b) => b.createdAt - a.createdAt);
                
                // Count pending
                const pendingCount = txArray.filter(tx => tx.status === 'pending').length;
                updateTransactionStats(pendingCount);

                let html = '';
                txArray.forEach(tx => {
                    const statusClass = `status-${tx.status}`;
                    const date = new Date(tx.createdAt).toLocaleString();
                    const amount = tx.amount ? tx.amount.toFixed(8) : '0.00000000';
                    
                    html += `
                        <tr>
                            <td>
                                <div>
                                    <p class="font-semibold text-gray-800">${tx.senderName || 'Unknown'}</p>
                                    <p class="text-xs text-gray-500">Acc: ${tx.senderAccount || 'N/A'}</p>
                                </div>
                            </td>
                            <td>
                                <span class="px-2 py-1 rounded-lg bg-indigo-100 text-indigo-700 text-xs font-semibold">
                                    ${tx.type || 'transfer'}
                                </span>
                            </td>
                            <td>
                                <p class="font-bold text-gray-800">${amount} ${(tx.currency || 'usd').toUpperCase()}</p>
                                <p class="text-xs text-gray-500">To: ${tx.recipientAccount || 'N/A'}</p>
                            </td>
                            <td class="text-sm text-gray-600">${date}</td>
                            <td>
                                <span class="${statusClass} px-3 py-1 rounded-full text-xs font-semibold uppercase">
                                    ${tx.status}
                                </span>
                            </td>
                            <td>
                                ${tx.status === 'pending' ? `
                                    <div class="flex gap-2">
                                        <button onclick='approveTransaction("${tx.id}")' class="px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition text-sm font-semibold">
                                            <i class="fas fa-check mr-1"></i>Approve
                                        </button>
                                        <button onclick='declineTransaction("${tx.id}")' class="px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition text-sm font-semibold">
                                            <i class="fas fa-times mr-1"></i>Decline
                                        </button>
                                    </div>
                                ` : `
                                    <button onclick='viewTransactionDetails("${tx.id}")' class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition text-sm">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                `}
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html || '<tr><td colspan="6" class="text-center py-8 text-gray-500">No transactions found</td></tr>';

            } catch (error) {
                console.error('Error loading transactions:', error);
                tbody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-red-500">Error loading transactions</td></tr>';
            }
        }

        // Update transaction stats
        function updateTransactionStats(pendingCount) {
            document.getElementById('pending-transactions').textContent = pendingCount;
        }

        // Approve transaction
        async function approveTransaction(txId) {
            if (!confirm('Are you sure you want to approve this transaction?')) return;

            try {
                // Get transaction details
                const txSnapshot = await database.ref('transactions/' + txId).once('value');
                const tx = txSnapshot.val();

                if (!tx) {
                    alert('Transaction not found');
                    return;
                }

                // Get sender data
                const senderSnapshot = await database.ref('users/' + tx.senderId).once('value');
                const senderData = senderSnapshot.val();

                if (!senderData) {
                    alert('Sender not found');
                    return;
                }

                // Deduct from sender
                if (tx.currency === 'usd') {
                    const newBalance = (senderData.usdBalance || 0) - tx.amount;
                    if (newBalance < 0) {
                        alert('Insufficient balance');
                        return;
                    }
                    await database.ref('users/' + tx.senderId).update({ usdBalance: newBalance });
                } else {
                    const crypto = senderData.cryptoHoldings || {};
                    const newAmount = (crypto[tx.currency] || 0) - tx.amount;
                    if (newAmount < 0) {
                        alert('Insufficient balance');
                        return;
                    }
                    crypto[tx.currency] = newAmount;
                    await database.ref('users/' + tx.senderId).update({ cryptoHoldings: crypto });
                }

                // Find and credit recipient
                const usersSnapshot = await database.ref('users').once('value');
                const users = usersSnapshot.val();
                let recipientId = null;

                for (let uid in users) {
                    if (users[uid].accountNumber === tx.recipientAccount) {
                        recipientId = uid;
                        break;
                    }
                }

                if (recipientId) {
                    const recipientSnapshot = await database.ref('users/' + recipientId).once('value');
                    const recipientData = recipientSnapshot.val();

                    if (tx.currency === 'usd') {
                        const newBalance = (recipientData.usdBalance || 0) + tx.amount;
                        await database.ref('users/' + recipientId).update({ usdBalance: newBalance });
                    } else {
                        const crypto = recipientData.cryptoHoldings || {};
                        crypto[tx.currency] = (crypto[tx.currency] || 0) + tx.amount;
                        await database.ref('users/' + recipientId).update({ cryptoHoldings: crypto });
                    }

                    // Add to recipient's transaction history
                    await database.ref('users/' + recipientId + '/transactions/' + txId).set({
                        ...tx,
                        status: 'completed',
                        type: 'received',
                        approvedAt: Date.now(),
                        approvedBy: auth.currentUser.email
                    });
                }

                // Update transaction status
                await database.ref('transactions/' + txId).update({
                    status: 'completed',
                    approvedAt: Date.now(),
                    approvedBy: auth.currentUser.email
                });

                // Update sender's transaction record
                await database.ref('users/' + tx.senderId + '/transactions/' + txId).update({
                    status: 'completed',
                    approvedAt: Date.now(),
                    approvedBy: auth.currentUser.email
                });

                alert('Transaction approved successfully!');
                loadTransactions();
                loadUsers();

            } catch (error) {
                console.error('Error approving transaction:', error);
                alert('Error approving transaction: ' + error.message);
            }
        }

        // Decline transaction
        async function declineTransaction(txId) {
            const reason = prompt('Enter reason for declining (optional):');
            if (reason === null) return; // User cancelled

            try {
                const txSnapshot = await database.ref('transactions/' + txId).once('value');
                const tx = txSnapshot.val();

                if (!tx) {
                    alert('Transaction not found');
                    return;
                }

                // Update transaction status
                await database.ref('transactions/' + txId).update({
                    status: 'declined',
                    declinedAt: Date.now(),
                    declinedBy: auth.currentUser.email,
                    declineReason: reason || 'No reason provided'
                });

                // Update sender's transaction record
                await database.ref('users/' + tx.senderId + '/transactions/' + txId).update({
                    status: 'declined',
                    declinedAt: Date.now(),
                    declinedBy: auth.currentUser.email,
                    declineReason: reason || 'No reason provided'
                });

                alert('Transaction declined');
                loadTransactions();

            } catch (error) {
                console.error('Error declining transaction:', error);
                alert('Error declining transaction');
            }
        }


        // View user details
        async function viewUser(uid) {
            const snapshot = await database.ref('users/' + uid).once('value');
            const user = snapshot.val();
            
            if (!user) {
                alert('User not found');
                return;
            }

            const crypto = user.cryptoHoldings || { btc: 0, eth: 0, usdt: 0, bnb: 0 };
            const prices = { btc: 45000, eth: 3000, usdt: 1, bnb: 400 };
            const cryptoValue = (crypto.btc * prices.btc) + (crypto.eth * prices.eth) + (crypto.usdt * prices.usdt) + (crypto.bnb * prices.bnb);

            document.getElementById('user-details-content').innerHTML = `
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Full Name</p>
                        <p class="font-bold text-gray-800">${user.firstName || ''} ${user.middleName || ''} ${user.lastName || ''}</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Username</p>
                        <p class="font-bold text-gray-800">@${user.username || 'N/A'}</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Email</p>
                        <p class="font-bold text-gray-800 text-sm break-all">${user.email || 'N/A'}</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Phone</p>
                        <p class="font-bold text-gray-800">${user.phone || 'N/A'}</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Country</p>
                        <p class="font-bold text-gray-800">${user.country || 'N/A'}</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Status</p>
                        <span class="status-${user.blocked ? 'blocked' : 'active'} px-3 py-1 rounded-full text-xs font-semibold uppercase inline-block">
                            ${user.blocked ? 'BLOCKED' : 'ACTIVE'}
                        </span>
                    </div>
                    <div class="p-4 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-600 text-white col-span-full">
                        <p class="text-xs opacity-90 mb-1">USD Balance</p>
                        <p class="text-3xl font-bold">${(user.usdBalance || 0).toFixed(2)}</p>
                    </div>
                    <div class="p-4 rounded-xl bg-gradient-to-r from-orange-500 to-pink-600 text-white col-span-full">
                        <p class="text-xs opacity-90 mb-1">Crypto Portfolio Value</p>
                        <p class="text-3xl font-bold">${cryptoValue.toFixed(2)}</p>
                    </div>
                    <div class="col-span-full">
                        <p class="text-sm font-semibold text-gray-700 mb-3">Crypto Holdings:</p>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-3 rounded-xl bg-orange-50">
                                <p class="text-xs text-gray-600 mb-1">Bitcoin</p>
                                <p class="font-bold text-gray-800">${(crypto.btc || 0).toFixed(8)} BTC</p>
                                <p class="text-xs text-gray-500">≈ ${(crypto.btc * prices.btc).toFixed(2)}</p>
                            </div>
                            <div class="p-3 rounded-xl bg-indigo-50">
                                <p class="text-xs text-gray-600 mb-1">Ethereum</p>
                                <p class="font-bold text-gray-800">${(crypto.eth || 0).toFixed(8)} ETH</p>
                                <p class="text-xs text-gray-500">≈ ${(crypto.eth * prices.eth).toFixed(2)}</p>
                            </div>
                            <div class="p-3 rounded-xl bg-green-50">
                                <p class="text-xs text-gray-600 mb-1">Tether</p>
                                <p class="font-bold text-gray-800">${(crypto.usdt || 0).toFixed(8)} USDT</p>
                                <p class="text-xs text-gray-500">≈ ${(crypto.usdt * prices.usdt).toFixed(2)}</p>
                            </div>
                            <div class="p-3 rounded-xl bg-yellow-50">
                                <p class="text-xs text-gray-600 mb-1">Binance Coin</p>
                                <p class="font-bold text-gray-800">${(crypto.bnb || 0).toFixed(8)} BNB</p>
                                <p class="text-xs text-gray-500">≈ ${(crypto.bnb * prices.bnb).toFixed(2)}</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 rounded-xl bg-gray-50 col-span-full">
                        <p class="text-xs text-gray-500 font-semibold mb-1">Member Since</p>
                        <p class="font-bold text-gray-800">${user.createdAt ? new Date(user.createdAt).toLocaleDateString() : 'N/A'}</p>
                    </div>
                </div>
            `;
            
            openModal('view-user-modal');
        }

        // Block/Unblock user
        async function toggleBlockUser(uid, currentlyBlocked) {
            const action = currentlyBlocked ? 'unblock' : 'block';
            if (!confirm(`Are you sure you want to ${action} this user?`)) return;

            try {
                await database.ref('users/' + uid).update({
                    blocked: !currentlyBlocked
                });
                alert(`User ${action}ed successfully`);
                loadUsers();
            } catch (error) {
                console.error('Error:', error);
                alert('Error updating user status');
            }
        }

        // Delete user
        async function deleteUser(uid) {
            if (!confirm('Are you sure you want to delete this user? This action cannot be undone!')) return;
            if (!confirm('Are you REALLY sure? All user data will be permanently deleted!')) return;

            try {
                // Delete from database
                await database.ref('users/' + uid).remove();
                
                // Note: Deleting from Firebase Auth requires admin SDK server-side
                alert('User deleted from database successfully. Note: User authentication still exists and should be removed from Firebase Console.');
                loadUsers();
            } catch (error) {
                console.error('Error:', error);
                alert('Error deleting user');
            }
        }

        // Fund user - quick access
        function fundUserQuick(uid) {
            const user = allUsers.find(u => u.uid === uid);
            if (!user) return;

            document.getElementById('fund-modal-content').innerHTML = `
                <div class="mb-4 p-4 rounded-xl bg-indigo-50">
                    <p class="text-sm text-gray-600">Funding for:</p>
                    <p class="font-bold text-gray-800">${user.firstName} ${user.lastName}</p>
                    <p class="text-xs text-gray-500">@${user.username}</p>
                </div>
                <form id="quick-fund-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Fund Type</label>
                        <select id="quick-fund-type" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none">
                            <option value="usd">USD</option>
                            <option value="btc">Bitcoin (BTC)</option>
                            <option value="eth">Ethereum (ETH)</option>
                            <option value="usdt">Tether (USDT)</option>
                            <option value="bnb">Binance Coin (BNB)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Amount</label>
                        <input type="number" step="0.00000001" id="quick-fund-amount" placeholder="0.00" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Note (Optional)</label>
                        <textarea id="quick-fund-note" rows="2" placeholder="Add a note..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 outline-none"></textarea>
                    </div>
                    <button type="submit" class="w-full py-3 rounded-xl gradient-success text-white font-semibold hover-up">
                        <i class="fas fa-check-circle mr-2"></i>Confirm Funding
                    </button>
                </form>
            `;

            document.getElementById('quick-fund-form').onsubmit = async (e) => {
                e.preventDefault();
                await processFunding(uid);
            };

            openModal('fund-modal');
        }

        // Process funding
        async function processFunding(uid) {
            const fundType = document.getElementById('quick-fund-type').value;
            const amount = parseFloat(document.getElementById('quick-fund-amount').value);
            const note = document.getElementById('quick-fund-note').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }

            try {
                const userRef = database.ref('users/' + uid);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();

                if (fundType === 'usd') {
                    const newBalance = (userData.usdBalance || 0) + amount;
                    await userRef.update({ usdBalance: newBalance });
                } else {
                    const crypto = userData.cryptoHoldings || { btc: 0, eth: 0, usdt: 0, bnb: 0 };
                    crypto[fundType] = (crypto[fundType] || 0) + amount;
                    await userRef.update({ cryptoHoldings: crypto });
                }

                alert(`Successfully funded ${amount} ${fundType.toUpperCase()}`);
                closeModal('fund-modal');
                loadUsers();
            } catch (error) {
                console.error('Error:', error);
                alert('Error processing funding');
            }
        }

        // Load users for funding dropdowns
        async function loadUsersForFunding() {
            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val();
                
                let options = '<option value="">Select a user</option>';
                for (let uid in users) {
                    const user = users[uid];
                    options += `<option value="${uid}">${user.firstName} ${user.lastName} (@${user.username})</option>`;
                }

                document.getElementById('fund-user-usd').innerHTML = options;
                document.getElementById('fund-user-crypto').innerHTML = options;
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Fund USD form submission
        document.getElementById('fund-usd-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const uid = document.getElementById('fund-user-usd').value;
            const amount = parseFloat(document.getElementById('fund-amount-usd').value);
            const note = document.getElementById('fund-note-usd').value;

            if (!uid || !amount || amount <= 0) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const userRef = database.ref('users/' + uid);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                const newBalance = (userData.usdBalance || 0) + amount;
                
                await userRef.update({ usdBalance: newBalance });
                
                alert(`Successfully funded ${amount} USD`);
                e.target.reset();
            } catch (error) {
                console.error('Error:', error);
                alert('Error processing funding');
            }
        });

        // Fund Crypto form submission
        document.getElementById('fund-crypto-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const uid = document.getElementById('fund-user-crypto').value;
            const cryptoType = document.getElementById('crypto-type').value;
            const amount = parseFloat(document.getElementById('fund-amount-crypto').value);
            const note = document.getElementById('fund-note-crypto').value;

            if (!uid || !amount || amount <= 0) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const userRef = database.ref('users/' + uid);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                const crypto = userData.cryptoHoldings || { btc: 0, eth: 0, usdt: 0, bnb: 0 };
                
                crypto[cryptoType] = (crypto[cryptoType] || 0) + amount;
                await userRef.update({ cryptoHoldings: crypto });
                
                alert(`Successfully funded ${amount} ${cryptoType.toUpperCase()}`);
                e.target.reset();
            } catch (error) {
                console.error('Error:', error);
                alert('Error processing funding');
            }
        });

        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                // Load users stats
                const usersSnapshot = await database.ref('users').once('value');
                const users = usersSnapshot.val();
                let totalUsers = 0;
                let activeUsers = 0;
                
                if (users) {
                    totalUsers = Object.keys(users).length;
                    activeUsers = Object.values(users).filter(u => !u.blocked).length;
                }

                document.getElementById('total-users').textContent = totalUsers;
                document.getElementById('active-users').textContent = activeUsers;

                // Load transactions stats
                const txSnapshot = await database.ref('transactions').once('value');
                const transactions = txSnapshot.val();
                let pendingCount = 0;
                let totalVolume = 0;

                if (transactions) {
                    const txArray = Object.values(transactions);
                    pendingCount = txArray.filter(tx => tx.status === 'pending').length;
                    
                    // Calculate total volume (convert all to USD approximation)
                    const prices = { usd: 1, btc: 45000, eth: 3000, usdt: 1, bnb: 400 };
                    txArray.filter(tx => tx.status === 'completed').forEach(tx => {
                        const price = prices[tx.currency] || 1;
                        totalVolume += tx.amount * price;
                    });
                }

                document.getElementById('pending-transactions').textContent = pendingCount;
                document.getElementById('total-volume').textContent = `${totalVolume.toFixed(2)}`;

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // Real-time transaction listener
        function listenForTransactions() {
            database.ref('transactions').on('value', (snapshot) => {
                if (currentSection === 'transactions') {
                    loadTransactions();
                }
                if (currentSection === 'dashboard') {
                    loadDashboardStats();
                }
            });
        }

        // Modal functions
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Admin logout
        async function adminLogout() {
            if (confirm('Are you sure you want to logout?')) {
                try {
                    await auth.signOut();
                    window.location.href = 'admin-login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                    alert('Error logging out');
                }
            }
        }

        // Change admin password
        function changeAdminPassword() {
            const newPassword = prompt('Enter new password (minimum 6 characters):');
            if (!newPassword || newPassword.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }

            auth.currentUser.updatePassword(newPassword)
                .then(() => alert('Password updated successfully'))
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error updating password. You may need to re-authenticate.');
                });
        }

        // Auth state change
        auth.onAuthStateChanged((user) => {
            if (!user) {
                window.location.href = 'admin-login.html';
                return;
            }

            // Check if user is admin (you should implement proper admin verification)
            // For now, we'll just check if email contains 'admin'
            if (!user.email.includes('admin')) {
                alert('Unauthorized access');
                auth.signOut();
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('admin-email').textContent = user.email;
            loadUsers();
            loadDashboardStats();
            listenForTransactions();
        });

        // Initialize dashboard
        window.addEventListener('load', () => {
            showSection('dashboard');
        });
    </script>
</body>
</html>